(()=>{"use strict";const e={apiAdminNotice:lpGlobalSettings.rest+"lp/v1/admin/tools/admin-notices",apiAdminOrderStatic:lpGlobalSettings.rest+"lp/v1/orders/statistic",apiAddons:lpGlobalSettings.rest+"lp/v1/addon/all",apiAddonAction:lpGlobalSettings.rest+"lp/v1/addon/action"};let t,s,a,n;const o=window.location.search,c=new URLSearchParams(o),l=c.get("tab");let i;const r=[],d=(e,t)=>{const s=i.querySelector(".lp-notify-action").cloneNode(!0);s.classList.remove("clone"),i.insertBefore(s,i[0]);const a=s.querySelector(`.${s.classList.value}__success`),n=s.querySelector(`.${s.classList.value}__error`);"success"===e?(a.classList.add("show"),a.querySelector(".message").innerHTML=t):(n.classList.add("show"),n.querySelector(".message").innerHTML=t),i.classList.add("show"),setTimeout((()=>{s.remove(),1===i.querySelectorAll(".lp-notify-action").length&&i.classList.remove("show")}),"success"===e?3e3:4e3)};!function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const n=l?`?tab=${l}`:`?${t}`;fetch(e.apiAddons+n,{method:"GET"}).then((e=>e.json())).then((e=>{const{status:t,message:n,data:o}=e;"success"===t?(s=o.html,a=o.addons):s=n})).catch((e=>{console.log(e)}))}();const u=e=>{e<4?n.classList.add("max-3-items"):n.classList.remove("max-3-items")},p=setInterval((()=>{if(t||i){if(s&&t&&i){t.innerHTML=s,n=t.querySelector("#lp-addons");const e=document.querySelector(".lp-nav-tab-wrapper"),a=e.cloneNode(!0);t.insertBefore(a,t.children[0]),a.style.display="flex",e.remove();const o=a.querySelector(".nav-tab.nav-tab-active span");u(parseInt(o.textContent)),clearInterval(p)}}else t=document.querySelector(".lp-addons-page"),i=document.querySelector(".lp-notify-action-wrapper")}),1);document.addEventListener("DOMContentLoaded",(e=>{})),document.addEventListener("click",(s=>{const n=s.target;if("span"===n.tagName.toLowerCase()){s.preventDefault();const e=n.closest(".btn-addon-action");e&&e.click()}if(n.classList.contains("btn-addon-action")){s.preventDefault(),n.classList.add("handling");let t="";const o=n.closest(".lp-addon-item"),c=a[o.dataset.slug],l=n.dataset.action,i=o.querySelector(".lp-addon-item__purchase");if("purchase"===l)return i.style.display="block",void(i.querySelector(".purchase-install").style.display="flex");if("update-purchase-code"===l)return i.querySelector(".purchase-update").style.display="flex",void(i.style.display="block");if("buy"===l){const e=n.dataset.link;return void window.open(e,"_blank")}if("cancel"===l)return void(i.style.display="none");if("install"===l&&n.dataset.link){n.classList.remove("handling");const e=n.dataset.link;return void window.open(e,"_blank")}i&&(t=i.querySelector("input[name=purchase-code]").value),((t,s)=>{const a=t.addon.slug;-1===r.indexOf(a)&&(r.push(a),fetch(e.apiAddonAction,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t})}).then((e=>e.json())).then((e=>{const t=r.indexOf(a);-1!==t&&r.splice(t,1);const{status:n,message:o,data:c}=e;s&&s(n),d(n,o)})).catch((e=>{d("error",`error js: ${e}`),console.log(e)})))})({purchase_code:t,action:l,addon:c},(function(e,t,s){if("success"===e)if("install"===l){o.classList.add("installed","activated"),o.classList.remove("not_installed"),i.style.display="none";const e=document.querySelector(".nav-tab[data-tab=installed] span");e.textContent=parseInt(e.textContent)+1;const t=document.querySelector(".nav-tab[data-tab=not_installed] span");t.textContent=parseInt(t.textContent)-1}else"update"===l?(o.querySelector(".addon-version-current").innerHTML=c.version,o.classList.remove("update")):"activate"===l?o.classList.add("activated"):"deactivate"===l&&o.classList.remove("activated");n.classList.remove("handling")}))}if(n.classList.contains("nav-tab")){s.preventDefault(),document.querySelectorAll(".nav-tab").forEach((function(e){e.classList.remove("nav-tab-active")})),n.classList.add("nav-tab-active");const e=n.dataset.tab,a=t.querySelectorAll(".lp-addon-item");t.querySelector("#lp-search-addons__input").value="",c.set("tab",e),window.history.pushState({},"",`${window.location.pathname}?${c.toString()}`);let o=0;a.forEach((t=>{t.classList.remove("search-not-found"),"all"===e||t.classList.contains(e)?(t.classList.remove("hide"),o++):t.classList.add("hide")})),u(o)}})),document.addEventListener("input",(e=>{const s=e.target;if("lp-search-addons__input"===s.id&&(e=>{const s=t.querySelectorAll(".lp-addon-item");let a=0;s.forEach((t=>{const s=t.querySelector("a").textContent;t.classList.contains("hide")||(s.toLowerCase().includes(e.toLowerCase())?(t.classList.remove("search-not-found"),a++):t.classList.add("search-not-found"))})),u(a)})(s.value),s.classList.contains("enter-purchase-code")){e.preventDefault();const t=s.value,a=s.closest(".lp-addon-item__purchase");a&&(a.querySelector("input[name=purchase-code]").value=t)}}))})();